CREATE OR REPLACE PROCEDURE GET_TOPIC_EAGER(
    P_ID IN NUMBER,
    TOPIC_NAME OUT VARCHAR2,
    RESULT_MESSAGES OUT NOCOPY SYS_REFCURSOR)
AS
BEGIN
    SELECT NAME INTO TOPIC_NAME
    FROM TOPIC WHERE ID = P_ID;
    
    OPEN RESULT_MESSAGES FOR
    SELECT FORUM_MESSAGE.ID AS MESSAGE_ID,
    TEXT AS MESSAGE_TEXT,
    TOPIC_ID,
    USER_ID,
    PUBLISH_DATE AS MESSAGE_DATE,
    FORUM_USER.LOGIN AS USER_LOGIN
    FROM FORUM_MESSAGE
    LEFT JOIN FORUM_USER ON 
         FORUM_USER.ID = FORUM_MESSAGE.USER_ID
    WHERE TOPIC_ID = P_ID;
END;
