CREATE OR REPLACE PROCEDURE GET_TOPIC_EAGER(
    P_ID IN NUMBER,
    TOPIC_NAME OUT VARCHAR2,
    RESULT_MESSAGES OUT NOCOPY SYS_REFCURSOR)
AS
BEGIN
    SELECT NAME INTO TOPIC_NAME
    FROM TOPIC WHERE ID = P_ID;
    
    OPEN RESULT_MESSAGES FOR
    SELECT FORUM_MESSAGE.ID AS MESSAGE_ID,
    TEXT AS MESSAGE_TEXT,
    TOPIC_ID,
    USER_ID,
    PUBLISH_DATE AS MESSAGE_DATE,
    FORUM_USER.LOGIN AS USER_LOGIN,
	USER_ROLE.ID AS ROLE_ID,
	USER_ROLE.NAME AS ROLE_NAME
    FROM FORUM_MESSAGE
    JOIN FORUM_USER ON 
        FORUM_USER.ID = FORUM_MESSAGE.USER_ID
	LEFT JOIN USER_ROLE ON
		USER_ROLE.ID = FORUM_USER.ROLE_ID
    WHERE TOPIC_ID = P_ID;
END;
