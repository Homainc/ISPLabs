CREATE OR REPLACE FUNCTION INSERT_TOPIC(
    P_NAME IN VARCHAR2,
    P_CATEGORY_ID IN NUMBER,
    P_USER_ID IN NUMBER,
    P_IS_CLOSED IN NUMBER,
    P_MESSAGE_TEXT IN VARCHAR2,
    NEW_TOPIC_ID OUT NUMBER,
    NEW_MESSAGE_ID OUT NUMBER,
    TOPIC_DATE OUT DATE,
    ER OUT VARCHAR2)
    RETURN NUMBER
AS
BEGIN
    TOPIC_DATE := SYSDATE;
    INSERT INTO TOPIC(NAME, CATEGORY_ID, USER_ID, PUBLISH_DATE, IS_CLOSED)
    VALUES(P_NAME, P_CATEGORY_ID, P_USER_ID, TOPIC_DATE, P_IS_CLOSED);
    SELECT ID INTO NEW_TOPIC_ID FROM TOPIC 
    WHERE PUBLISH_DATE = CURRENT_DATE AND CATEGORY_ID = P_CATEGORY_ID
    AND USER_ID = P_USER_ID AND NAME = P_NAME;
    INSERT INTO FORUM_MESSAGE(TOPIC_ID, USER_ID, TEXT, PUBLISH_DATE) VALUES(NEW_TOPIC_ID, P_USER_ID, P_MESSAGE_TEXT, TOPIC_DATE);
    SELECT ID INTO NEW_MESSAGE_ID FROM FORUM_MESSAGE 
    WHERE TOPIC_ID = NEW_TOPIC_ID AND PUBLISH_DATE = CURRENT_DATE AND USER_ID = P_USER_ID;
    RETURN 1;
EXCEPTION
    WHEN OTHERS THEN
        ER := 'Insert topic failed';
    RETURN 0;
END;